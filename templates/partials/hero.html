{# templates/partials/hero.html #}
{% load wagtailcore_tags wagtailimages_tags %}

{# Usage:
   {% include "partials/hero.html" with
        hero_id="page-hero"
        hero_title=page.title
        hero_intro=page.intro
   %}
#}

<section id="{{ hero_id|default:'page-hero' }}"
         class="relative isolate overflow-hidden min-h-[60svh] md:min-h-[70svh] lg:min-h-[70svh]">
  {% if page.hero_image %}
    <!-- Background + overlays -->
    <div class="absolute inset-0 z-0">
      <div class="parallax-bg absolute inset-0 will-change-[transform] transform-gpu">
        {% image page.hero_image width-2560
           alt=page.hero_image.title
           class="w-full h-full object-cover object-center" loading="eager" decoding="async" sizes="100vw" %}
      </div>

      <!-- Brand gradient -->
      <div class="absolute inset-0 bg-gradient-to-r from-primary-900/90 via-primary-900/80 to-primary-900/40"></div>

      <!-- Soft vignette top/bottom -->
      <div class="absolute inset-x-0 top-0 h-24 bg-gradient-to-b from-black/20 to-transparent"></div>
      <div class="absolute inset-x-0 bottom-0 h-24 bg-gradient-to-t from-black/20 to-transparent"></div>

      <!-- Subtle moving sheen (very light) -->
      <div class="pointer-events-none absolute inset-0 opacity-[0.06] mix-blend-screen animate-hero-sheen"></div>
    </div>
  {% endif %}

  <!-- Foreground content -->
  <div class="relative z-10 container mx-auto px-4 h-full">
    <div class="h-full flex items-end justify-center text-center pb-10">
      <div class="max-w-3xl">
        <h1 class="text-4xl md:text-5xl font-bold text-white mb-4 opacity-0 animate-fade-in-up">
          {{ hero_title|default:page.title }}
        </h1>

        {% if hero_intro|default:page.intro %}
          <div class="text-lg md:text-xl text-white/90 leading-relaxed prose prose-invert mx-auto opacity-0 animate-fade-in-up"
               style="animation-delay:120ms">
            {{ hero_intro|default:page.intro|richtext }}
          </div>
        {% endif %}
      </div>
    </div>
  </div>
</section>

<style>
/* Keyframes kept minimal & local to hero */
@keyframes fadeInUp {
  from { opacity:0; transform: translateY(22px); }
  to   { opacity:1; transform: translateY(0); }
}
.animate-fade-in-up { animation: fadeInUp .7s ease-out forwards; }

/* ultra-subtle highlight that drifts across */
@keyframes heroSheen {
  0%   { background: radial-gradient(1200px 600px at -20% 30%, rgba(255,255,255,.8), transparent 60%); }
  50%  { background: radial-gradient(1200px 600px at 120% 60%, rgba(255,255,255,.8), transparent 60%); }
  100% { background: radial-gradient(1200px 600px at -20% 30%, rgba(255,255,255,.8), transparent 60%); }
}
.animate-hero-sheen { animation: heroSheen 18s linear infinite; }

/* prefers-reduced-motion: respect user setting */
@media (prefers-reduced-motion: reduce) {
  .animate-fade-in-up { animation: none; opacity:1; transform:none; }
  .animate-hero-sheen { display:none; }
}
</style>

<script>
/* Parallax (gentle, GPU-friendly, respects reduced motion) */
(function () {
  const root = document.getElementById('{{ hero_id|default:"page-hero" }}');
  if (!root) return;
  const img = root.querySelector('.parallax-bg img');
  const reduce = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
  if (!img || reduce) return;

  function onScroll() {
    const r = root.getBoundingClientRect();
    // progress 0..1 over hero height
    const progress = Math.min(1, Math.max(0, (0 - r.top) / Math.max(1, r.height)));
    img.style.transform = `translateY(${progress * 80}px) scale(1.08)`;
    img.style.willChange = 'transform';
  }

  let ticking = false;
  window.addEventListener('scroll', () => {
    if (!ticking) {
      requestAnimationFrame(() => { onScroll(); ticking = false; });
      ticking = true;
    }
  }, { passive: true });

  onScroll();
})();
</script>
