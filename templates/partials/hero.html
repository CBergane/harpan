{# templates/partials/hero.html #}
{% load wagtailcore_tags wagtailimages_tags %}

<section id="{{ hero_id|default:'page-hero' }}"
         class="relative isolate overflow-hidden min-h-[75vh] flex items-center">
  
  {% if page.hero_image %}
    <!-- Background + overlays -->
    <div class="absolute inset-0 z-0">
      <!-- Parallax Image -->
      <div class="parallax-bg absolute inset-0 will-change-transform">
        {% image page.hero_image width-2560 as hero_img %}
        <img src="{{ hero_img.url }}"
             alt="{{ page.hero_image.title }}"
             class="w-full h-full object-cover object-center scale-110"
             loading="eager"
             decoding="async"
             width="{{ hero_img.width }}"
             height="{{ hero_img.height }}">
      </div>

      <!-- Sophisticated gradient overlay -->
      <div class="absolute inset-0 bg-gradient-to-r from-primary-900/95 via-primary-900/85 to-primary-900/50"></div>
      
      <!-- Vignette for depth -->
      <div class="absolute inset-0">
        <div class="absolute inset-x-0 top-0 h-32 bg-gradient-to-b from-black/30 to-transparent"></div>
        <div class="absolute inset-x-0 bottom-0 h-32 bg-gradient-to-t from-black/30 to-transparent"></div>
        <div class="absolute inset-y-0 left-0 w-32 bg-gradient-to-r from-black/20 to-transparent"></div>
      </div>

      <!-- Subtle animated sheen -->
      <div class="pointer-events-none absolute inset-0 opacity-[0.04] mix-blend-screen animate-hero-sheen"></div>
      
      <!-- Floating particles (optional subtle effect) -->
      <div class="absolute inset-0 opacity-20">
        <div class="particle" style="left: 10%; top: 20%; animation-delay: 0s;"></div>
        <div class="particle" style="left: 80%; top: 40%; animation-delay: 2s;"></div>
        <div class="particle" style="left: 60%; top: 70%; animation-delay: 4s;"></div>
        <div class="particle" style="left: 30%; top: 80%; animation-delay: 6s;"></div>
      </div>
    </div>
  {% else %}
    <!-- Fallback: Beautiful gradient -->
    <div class="absolute inset-0 z-0 bg-gradient-to-br from-primary-900 via-primary-800 to-primary-700">
      <!-- Animated mesh gradient -->
      <div class="absolute inset-0 opacity-30" style="background: radial-gradient(circle at 20% 50%, rgba(255,255,255,0.1) 0%, transparent 50%), radial-gradient(circle at 80% 80%, rgba(255,255,255,0.1) 0%, transparent 50%);"></div>
    </div>
  {% endif %}

  <!-- Foreground content - centered with generous spacing -->
  <div class="relative z-10 container mx-auto px-4 py-16 md:py-20">
    <div class="max-w-5xl mx-auto md:mx-0">
      
      <!-- Breadcrumb trail (optional) - ALL WHITE -->
      {% if show_breadcrumb %}
      <nav class="mb-8 opacity-0 hero-breadcrumb" aria-label="Breadcrumb">
        <ol class="flex items-center gap-2 text-sm text-white/80">
          <li><a href="/" class="hover:text-white transition">Hem</a></li>
          <li><i data-lucide="chevron-right" class="w-3 h-3"></i></li>
          <li class="text-white">{{ page.title }}</li>
        </ol>
      </nav>
      {% endif %}
      
      <!-- Title - ALL WHITE -->
      <h1 class="text-4xl sm:text-5xl md:text-6xl lg:text-7xl font-bold text-white mb-6 leading-[1.1] opacity-0 hero-title">
        {{ hero_title|default:page.title }}
        <!-- Animated underline accent - WHITE -->
        <div class="h-1.5 w-24 md:w-32 bg-white rounded-full mt-6 opacity-0 hero-accent"></div>
      </h1>

      <!-- Intro text - ALL WHITE -->
      {% if hero_intro or page.intro %}
      <div class="max-w-3xl opacity-0 hero-intro">
        <div class="text-lg sm:text-xl md:text-2xl text-white leading-relaxed font-light prose-invert-custom">
          {{ hero_intro|default:page.intro|richtext }}
        </div>
      </div>
      {% endif %}
      
      <!-- CTA Buttons (optional) -->
      {% if show_cta %}
      <div class="flex flex-wrap gap-4 mt-10 opacity-0 hero-cta">
        <a href="#services" 
           class="inline-flex items-center gap-2 px-8 py-4 bg-white text-primary-900 font-semibold rounded-xl shadow-xl hover:shadow-2xl hover:scale-105 transition-all duration-300 group text-lg">
          <span>Se våra tjänster</span>
          <i data-lucide="arrow-down" class="w-5 h-5 group-hover:translate-y-1 transition-transform"></i>
        </a>
        <a href="/kontakt/" 
           class="inline-flex items-center gap-2 px-8 py-4 border-2 border-white text-white font-semibold rounded-xl hover:bg-white hover:text-primary-900 transition-all duration-300 group text-lg">
          <span>Kontakta oss</span>
          <i data-lucide="arrow-right" class="w-5 h-5 group-hover:translate-x-1 transition-transform"></i>
        </a>
      </div>
      {% endif %}
    </div>
  </div>
  
  <!-- Scroll indicator - ALL WHITE -->
  <div class="absolute bottom-12 left-1/2 -translate-x-1/2 opacity-0 hero-scroll">
    <div class="flex flex-col items-center gap-3 text-white/70 hover:text-white transition cursor-pointer animate-bounce-gentle" 
         onclick="window.scrollBy({top: window.innerHeight * 0.8, behavior: 'smooth'})">
      <span class="text-sm font-medium uppercase tracking-wider">Scroll</span>
      <div class="w-6 h-10 border-2 border-white/50 rounded-full flex items-start justify-center p-2">
        <div class="w-1.5 h-3 bg-white/70 rounded-full animate-scroll-bounce"></div>
      </div>
    </div>
  </div>
</section>

<style>
/* === ANIMATIONS === */

/* Fade in up - smoother */
@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(40px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Fade in - simple */
@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

/* Scale in */
@keyframes scaleIn {
  from {
    opacity: 0;
    transform: scale(0.95);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}

/* Scroll bounce indicator */
@keyframes scrollBounce {
  0%, 100% {
    transform: translateY(0);
  }
  50% {
    transform: translateY(8px);
  }
}

/* Gentle bounce for whole indicator */
@keyframes bounceGentle {
  0%, 100% {
    transform: translateY(0);
  }
  50% {
    transform: translateY(-10px);
  }
}

/* Floating particles */
@keyframes float {
  0%, 100% {
    transform: translateY(0) translateX(0);
    opacity: 0.3;
  }
  50% {
    transform: translateY(-30px) translateX(20px);
    opacity: 0.6;
  }
}

/* Moving sheen */
@keyframes heroSheen {
  0% {
    background: radial-gradient(1200px 600px at -20% 30%, rgba(255,255,255,0.8), transparent 60%);
  }
  50% {
    background: radial-gradient(1200px 600px at 120% 60%, rgba(255,255,255,0.8), transparent 60%);
  }
  100% {
    background: radial-gradient(1200px 600px at -20% 30%, rgba(255,255,255,0.8), transparent 60%);
  }
}

/* === APPLY ANIMATIONS === */

.hero-breadcrumb {
  animation: fadeIn 0.8s ease-out 0.1s forwards;
}

.hero-title {
  animation: fadeInUp 0.9s cubic-bezier(0.16, 1, 0.3, 1) 0.2s forwards;
}

.hero-accent {
  animation: scaleIn 0.6s cubic-bezier(0.16, 1, 0.3, 1) 0.8s forwards;
  transform-origin: left center;
}

.hero-intro {
  animation: fadeInUp 0.9s cubic-bezier(0.16, 1, 0.3, 1) 0.4s forwards;
}

.hero-cta {
  animation: fadeInUp 0.9s cubic-bezier(0.16, 1, 0.3, 1) 0.6s forwards;
}

.hero-scroll {
  animation: fadeIn 1s ease-out 1.2s forwards;
}

.animate-scroll-bounce {
  animation: scrollBounce 2s ease-in-out infinite;
}

.animate-bounce-gentle {
  animation: bounceGentle 3s ease-in-out infinite;
}

.animate-hero-sheen {
  animation: heroSheen 20s linear infinite;
}

/* Particles */
.particle {
  position: absolute;
  width: 4px;
  height: 4px;
  background: white;
  border-radius: 50%;
  animation: float 8s ease-in-out infinite;
}

/* === ALL TEXT WHITE === */

.hero-title {
  color: white;
  text-shadow: 
    0 2px 8px rgba(0,0,0,0.3),
    0 4px 16px rgba(0,0,0,0.2);
}

.hero-intro {
  color: white;
  text-shadow: 
    0 1px 4px rgba(0,0,0,0.4),
    0 2px 8px rgba(0,0,0,0.2);
}

/* Rich text styling inside hero - FORCE WHITE */
.hero-intro p,
.hero-intro p *,
.prose-invert-custom,
.prose-invert-custom * {
  color: white !important;
  margin-bottom: 0;
}

.hero-intro strong,
.prose-invert-custom strong {
  font-weight: 600;
  color: white !important;
}

.hero-intro em,
.prose-invert-custom em {
  color: white !important;
}

.hero-intro a,
.prose-invert-custom a {
  color: white !important;
  text-decoration: underline;
}

/* === RESPONSIVE === */

@media (max-width: 640px) {
  .hero-title {
    font-size: 2.5rem;
    line-height: 1.1;
  }
  
  .hero-intro {
    font-size: 1.125rem;
  }
}

/* === REDUCED MOTION === */

@media (prefers-reduced-motion: reduce) {
  .hero-breadcrumb,
  .hero-title,
  .hero-accent,
  .hero-intro,
  .hero-cta,
  .hero-scroll {
    animation: none;
    opacity: 1;
    transform: none;
  }
  
  .animate-hero-sheen,
  .animate-scroll-bounce,
  .animate-bounce-gentle,
  .particle {
    display: none;
  }
}
</style>

<script>
(function () {
  const root = document.getElementById('{{ hero_id|default:"page-hero" }}');
  if (!root) return;
  
  const img = root.querySelector('.parallax-bg img');
  const reduce = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
  
  if (!img || reduce) return;

  // Smooth parallax with RAF
  function updateParallax() {
    const rect = root.getBoundingClientRect();
    const scrollProgress = Math.min(1, Math.max(0, (0 - rect.top) / Math.max(1, rect.height)));
    
    // Slower, smoother parallax
    const translateY = scrollProgress * 60;
    img.style.transform = `translateY(${translateY}px) scale(1.1)`;
  }

  // Throttled scroll handler
  let ticking = false;
  function onScroll() {
    if (!ticking) {
      requestAnimationFrame(() => {
        updateParallax();
        ticking = false;
      });
      ticking = true;
    }
  }

  window.addEventListener('scroll', onScroll, { passive: true });
  
  // Initial call
  updateParallax();
  
  // Reinitialize Lucide icons after content loads
  if (typeof lucide !== 'undefined') {
    lucide.createIcons();
  }
})();
</script>