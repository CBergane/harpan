{% extends "base.html" %}
{% load wagtailcore_tags wagtailimages_tags static %}

{% block body_class %}is-home{% endblock %}

{% block extra_css %}
<style>
   /* =========================
     HOME: Brand ‚Äúfloating icon‚Äù
     ========================= */
  body.is-home #nav-brand{
    opacity: 0;
    transform: translateY(2px);
    pointer-events: none;
    transition: opacity 220ms ease, transform 220ms ease;
  }
  body.is-home.is-brand-docked #nav-brand{
    opacity: 1;
    transform: translateY(0);
    pointer-events: auto;
  }

  #brand-wordmark{
    position: fixed;
    left: 50%;
    top: calc(var(--nav-h, 80px) + 90px); /* üîº flyttad n√§rmare navbaren */
    transform: translate(-50%, -50%) scale(var(--scale, 1));
    transform-origin: center;
    pointer-events: none;
    user-select: none;
    z-index: 45; /* under navbar (z-50), √∂ver hero */
    opacity: 1;
    will-change: left, top, transform, opacity;
  }

  #brand-wordmark .brand-wordmark-icon{
    width: clamp(8.5rem, 12vw, 9.5rem);
    height: clamp(8.5rem, 12vw, 9.5rem);
    border-radius: 1.25rem;
    
    border: 1px solid rgba(15,23,42,0.12);
    box-shadow: 0 18px 45px rgba(0,0,0,.45);
    overflow: hidden;
  }

  body.is-home.is-brand-docked #brand-wordmark{
    opacity: 0;
  }

  @media (max-width: 767px){
    /* Ingen Gucci-effekt p√• mobil */
    #brand-wordmark{
      display: none;
    }
    body.is-home #nav-brand{
      opacity: 1 !important;
      transform: none !important;
      pointer-events: auto !important;
    }
  }

  /* üîΩ Se till att hero-text inte krockar med ikonen */
  body.is-home #home-hero-inner{
    padding-top: 5rem; /* justera efter smak, t.ex. 4‚Äì6rem */
  }
  body.is-home.is-brand-docked #home-hero-inner{
    padding-top: 0;
  }
  @media (max-width: 767px){
    body.is-home #home-hero-inner{
      padding-top: 0;
    }
  }


  /* ===== Animations (dina) ===== */
  @keyframes fadeInUp {
    from { opacity: 0; transform: translateY(30px); }
    to   { opacity: 1; transform: translateY(0); }
  }
  @keyframes fadeInRight {
    from { opacity: 0; transform: translateX(-30px); }
    to   { opacity: 1; transform: translateX(0); }
  }
  @keyframes slideInLeft {
    from { opacity: 0; transform: translateX(50px); }
    to   { opacity: 1; transform: translateX(0); }
  }
  @keyframes scroll {
    0%   { transform: translateX(0); }
    100% { transform: translateX(calc(-336px * 4)); }
  }

  .animate-fade-in-up    { animation: fadeInUp 0.8s ease-out forwards; }
  .animate-fade-in-right { animation: fadeInRight 0.8s ease-out forwards; }
  .animate-slide-in-left { animation: slideInLeft 0.8s ease-out forwards; }
  .animate-scroll        { animation: scroll 30s linear infinite; }
  .animate-scroll:hover  { animation-play-state: paused; }

  /* ===== Scroll reveal ===== */
  [data-scroll]{
    opacity: 0;
    transform: translateY(30px);
    transition: opacity 0.8s ease-out, transform 0.8s ease-out;
    will-change: opacity, transform;
  }
  [data-scroll].visible{
    opacity: 1;
    transform: translateY(0);
  }

  /* ===== Parallax ===== */
  .parallax-bg { will-change: transform; }


</style>
{% endblock %}

{% block floating_brand %}
  <div id="brand-wordmark"
       aria-hidden="true"
       class="flex items-center justify-center">
    <div class="brand-wordmark-icon">
      <img src="{% static 'images/icon-harp-final.png' %}"
           alt="Harpans"
           class="w-full h-full object-cover">
    </div>
  </div>
{% endblock %}

{% block content %}

<section data-hero class="relative py-24 md:py-32 overflow-hidden">
    <!-- Bakgrundsbild med parallax -->
    <div class="absolute inset-0 parallax-bg">
        <img
            src="{% static 'images/hero-office.jpeg' %}"
            alt="Redovisning f√∂r moderna f√∂retag"
            class="w-full h-full object-cover transform scale-110"
        >
    </div>

    <!-- F√§rg-overlay -->
    <div class="absolute inset-0 bg-gradient-to-r from-primary-900/70 via-primary-900/60 to-primary-900/50"></div>

    <!-- Vignette -->
    <div class="absolute inset-x-0 top-0 h-32 bg-gradient-to-b from-black/20 to-transparent"></div>
    <div class="absolute inset-x-0 bottom-0 h-32 bg-gradient-to-t from-black/20 to-transparent"></div>

    <!-- Inneh√•ll - Animated -->
    <div class="relative container mx-auto px-4" id="home-hero-inner">
        <div class="max-w-3xl text-left md:text-left">
            <h1 class="text-4xl md:text-6xl font-bold mb-6 text-white leading-tight opacity-0 animate-fade-in-up" style="animation-delay: 100ms">
                {{ page.hero_title }}
            </h1>

            {% if page.hero_subtitle %}
            <div class="text-lg md:text-2xl text-white/90 mb-8 leading-relaxed prose prose-invert opacity-0 animate-fade-in-up" style="animation-delay: 300ms">
                {{ page.hero_subtitle|richtext }}
            </div>
            {% endif %}

            <div class="flex flex-col sm:flex-row gap-4 opacity-0 animate-fade-in-up" style="animation-delay: 500ms">
                {% if settings.core.NavigationSettings.contact_page %}
                <a href="{% pageurl settings.core.NavigationSettings.contact_page %}"
                   class="inline-flex items-center justify-center px-8 py-4 rounded-lg bg-white text-primary-800 font-semibold shadow-lg hover:bg-gray-100 hover:scale-105 hover:shadow-xl transition-all duration-300 group">
                    {{ page.hero_cta_text }}
                    <i data-lucide="arrow-right" class="w-5 h-5 ml-2 transition-transform group-hover:translate-x-1"></i>
                </a>
                {% else %}
                <a href="/kontakt/"
                   class="inline-flex items-center justify-center px-8 py-4 rounded-lg bg-white text-primary-800 font-semibold shadow-lg hover:bg-gray-100 hover:scale-105 hover:shadow-xl transition-all duration-300 group">
                    {{ page.hero_cta_text }}
                    <i data-lucide="arrow-right" class="w-5 h-5 ml-2 transition-transform group-hover:translate-x-1"></i>
                </a>
                {% endif %}

                {% if settings.core.NavigationSettings.services_page %}
                <a href="{% pageurl settings.core.NavigationSettings.services_page %}"
                   class="inline-flex items-center gap-2 px-8 py-4 rounded-lg border-2 border-white text-white font-semibold hover:bg-white hover:text-primary-800 transition-all duration-300">
                    L√§s mer
                    <i data-lucide="arrow-right" class="w-4 h-4"></i>
                </a>
                {% else %}
                <a href="/tjanster/"
                   class="inline-flex items-center gap-2 px-8 py-4 rounded-lg border-2 border-white text-white font-semibold hover:bg-white hover:text-primary-800 transition-all duration-300">
                    L√§s mer
                    <i data-lucide="arrow-right" class="w-4 h-4"></i>
                </a>
                {% endif %}
            </div>

            <!-- Trust badges -->
            <div class="flex flex-wrap gap-4 mt-10 text-sm text-white/80">
                <div class="flex items-center gap-2 opacity-0 animate-fade-in-right" style="animation-delay: 700ms">
                    <i data-lucide="check-circle" class="w-5 h-5"></i>
                    Auktoriserad byr√•
                </div>
                <div class="flex items-center gap-2 opacity-0 animate-fade-in-right" style="animation-delay: 800ms">
                    <i data-lucide="shield-check" class="w-5 h-5"></i>
                    GDPR-s√§ker
                </div>
                <div class="flex items-center gap-2 opacity-0 animate-fade-in-right" style="animation-delay: 900ms">
                    <i data-lucide="clock" class="w-5 h-5"></i>
                    Snabb support
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Om oss-sektion -->
{% if page.about_text %}
<section class="py-20 bg-white scroll-reveal">
  <div class="container mx-auto px-4">
    <div class="max-w-4xl mx-auto text-center mb-16 opacity-0 animate-fade-in-up" data-scroll>
      <h2 class="text-4xl md:text-5xl font-bold text-primary-800 mb-6">
        {{ page.about_title }}
      </h2>
      <div class="text-lg text-gray-700 leading-relaxed prose prose-lg mx-auto">
        {{ page.about_text|richtext }}
      </div>
    </div>

    {% if page.value_1_title or page.value_2_title or page.value_3_title %}
    <div class="grid md:grid-cols-3 gap-8 max-w-6xl mx-auto">
      {% if page.value_1_title %}
      <div class="value-card bg-white border-2 border-gray-200 rounded-2xl p-8 text-center hover:border-primary-600 hover:shadow-xl hover:-translate-y-2 transition-all duration-500 group opacity-0" data-scroll style="animation-delay: 100ms">
        <div class="w-20 h-20 bg-primary-600 rounded-2xl flex items-center justify-center mx-auto mb-6 group-hover:scale-110 group-hover:rotate-6 transition-all duration-500 shadow-lg">
          <i data-lucide="{{ page.value_1_icon }}" class="w-10 h-10 text-white"></i>
        </div>
        <h3 class="text-2xl font-bold text-gray-900 mb-4">{{ page.value_1_title }}</h3>
        <p class="text-gray-600 leading-relaxed">{{ page.value_1_text }}</p>
      </div>
      {% endif %}

      {% if page.value_2_title %}
      <div class="value-card bg-white border-2 border-gray-200 rounded-2xl p-8 text-center hover:border-primary-600 hover:shadow-xl hover:-translate-y-2 transition-all duration-500 group opacity-0" data-scroll style="animation-delay: 200ms">
        <div class="w-20 h-20 bg-primary-600 rounded-2xl flex items-center justify-center mx-auto mb-6 group-hover:scale-110 group-hover:rotate-6 transition-all duration-500 shadow-lg">
          <i data-lucide="{{ page.value_2_icon }}" class="w-10 h-10 text-white"></i>
        </div>
        <h3 class="text-2xl font-bold text-gray-900 mb-4">{{ page.value_2_title }}</h3>
        <p class="text-gray-600 leading-relaxed">{{ page.value_2_text }}</p>
      </div>
      {% endif %}

      {% if page.value_3_title %}
      <div class="value-card bg-white border-2 border-gray-200 rounded-2xl p-8 text-center hover:border-primary-600 hover:shadow-xl hover:-translate-y-2 transition-all duration-500 group opacity-0" data-scroll style="animation-delay: 300ms">
        <div class="w-20 h-20 bg-primary-600 rounded-2xl flex items-center justify-center mx-auto mb-6 group-hover:scale-110 group-hover:rotate-6 transition-all duration-500 shadow-lg">
          <i data-lucide="{{ page.value_3_icon }}" class="w-10 h-10 text-white"></i>
        </div>
        <h3 class="text-2xl font-bold text-gray-900 mb-4">{{ page.value_3_title }}</h3>
        <p class="text-gray-600 leading-relaxed">{{ page.value_3_text }}</p>
      </div>
      {% endif %}
    </div>
    {% endif %}
  </div>
</section>
{% endif %}


<!-- Services Section - Stagger grid -->
<section id="tjanster" class="py-20 bg-gray-50">
    <div class="container mx-auto px-4">
        <div class="text-center max-w-3xl mx-auto mb-16" data-scroll>
            <h2 class="text-4xl md:text-5xl font-bold text-gray-900 mb-4">
                <span data-sparkle class="sparkle-once">V√•ra tj√§nster</span>
            </h2>
            <p class="text-xl text-gray-600">
                Allt du beh√∂ver f√∂r att f√• ordning p√• f√∂retagets ekonomi
            </p>
        </div>
        
        <div class="grid md:grid-cols-3 gap-8 max-w-6xl mx-auto">
            <!-- Service 1 -->
            <div class="service-card bg-white border-2 border-gray-200 rounded-2xl p-8 hover:border-primary-600 hover:shadow-2xl hover:-translate-y-2 transition-all duration-500 group cursor-pointer opacity-0" data-scroll style="animation-delay: 100ms">
                <div class="w-16 h-16 bg-gray-100 rounded-xl flex items-center justify-center mb-6 group-hover:scale-110 group-hover:rotate-6 group-hover:bg-primary-600 transition-all duration-500 shadow-lg">
                    <i data-lucide="calculator" class="w-8 h-8 text-gray-700 group-hover:text-white transition-colors duration-500"></i>
                </div>
                <h3 class="text-2xl font-bold text-gray-900 mb-4 group-hover:text-primary-600 transition-colors">
                    Bokf√∂ring & Redovisning
                </h3>
                <p class="text-gray-600 mb-6 leading-relaxed">
                    L√•t oss sk√∂ta bokf√∂ringen s√• du kan fokusera p√• ditt f√∂retag.
                </p>
                <a href="/tjanster/" class="inline-flex items-center gap-2 text-primary-600 font-semibold hover:gap-3 transition-all group/btn">
                    L√§s mer
                    <i data-lucide="arrow-right" class="w-4 h-4 transition-transform group-hover/btn:translate-x-1"></i>
                </a>
            </div>
            
            <!-- Service 2 -->
            <div class="service-card bg-white border-2 border-gray-200 rounded-2xl p-8 hover:border-primary-600 hover:shadow-2xl hover:-translate-y-2 transition-all duration-500 group cursor-pointer opacity-0" data-scroll style="animation-delay: 200ms">
                <div class="w-16 h-16 bg-gray-100 rounded-xl flex items-center justify-center mb-6 group-hover:scale-110 group-hover:rotate-6 group-hover:bg-primary-600 transition-all duration-500 shadow-lg">
                    <i data-lucide="trending-up" class="w-8 h-8 text-gray-700 group-hover:text-white transition-colors duration-500"></i>
                </div>
                <h3 class="text-2xl font-bold text-gray-900 mb-4 group-hover:text-primary-600 transition-colors">
                    Ekonomisk r√•dgivning
                </h3>
                <p class="text-gray-600 mb-6 leading-relaxed">
                    Vi hj√§lper dig ta smartare ekonomiska beslut.
                </p>
                <a href="/tjanster/" class="inline-flex items-center gap-2 text-primary-600 font-semibold hover:gap-3 transition-all group/btn">
                    L√§s mer
                    <i data-lucide="arrow-right" class="w-4 h-4 transition-transform group-hover/btn:translate-x-1"></i>
                </a>
            </div>
            
            <!-- Service 3 -->
            <div class="service-card bg-white border-2 border-gray-200 rounded-2xl p-8 hover:border-primary-600 hover:shadow-2xl hover:-translate-y-2 transition-all duration-500 group cursor-pointer opacity-0" data-scroll style="animation-delay: 300ms">
                <div class="w-16 h-16 bg-gray-100 rounded-xl flex items-center justify-center mb-6 group-hover:scale-110 group-hover:rotate-6 group-hover:bg-primary-600 transition-all duration-500 shadow-lg">
                    <i data-lucide="file-text" class="w-8 h-8 text-gray-700 group-hover:text-white transition-colors duration-500"></i>
                </div>
                <h3 class="text-2xl font-bold text-gray-900 mb-4 group-hover:text-primary-600 transition-colors">
                    Deklarationer & Skatt
                </h3>
                <p class="text-gray-600 mb-6 leading-relaxed">
                    Korrekt och i tid, varje g√•ng.
                </p>
                <a href="/tjanster/" class="inline-flex items-center gap-2 text-primary-600 font-semibold hover:gap-3 transition-all group/btn">
                    L√§s mer
                    <i data-lucide="arrow-right" class="w-4 h-4 transition-transform group-hover/btn:translate-x-1"></i>
                </a>
            </div>
        </div>
    </div>
</section>

<!-- Featured Team Member - Slide in fr√•n sidan -->
{% if featured_member %}
<section class="py-20 bg-gray-50">
    <div class="container mx-auto px-4">
        <div class="text-center mb-12 opacity-0 animate-fade-in-up" data-scroll>
            <h2 class="text-4xl md:text-5xl font-bold text-gray-900 mb-4">
                Din kontaktperson
            </h2>
            <p class="text-xl text-gray-600">
                Boka ett kostnadsfritt m√∂te direkt
            </p>
        </div>
        
        <div class="max-w-5xl mx-auto opacity-0 animate-slide-in-left" data-scroll>
            <div class="bg-white border-2 border-gray-200 rounded-3xl overflow-hidden hover:border-primary-600 hover:shadow-2xl transition-all duration-500">
                <div class="grid md:grid-cols-2 gap-0">
                    <!-- Photo -->
                    <div class="aspect-square md:aspect-auto overflow-hidden relative bg-gray-100 group">
                        {% if featured_member.photo %}
                            {% image featured_member.photo fill-600x800 class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110" %}
                        {% else %}
                            <div class="w-full h-full bg-gradient-to-br from-primary-100 to-primary-50 flex items-center justify-center">
                                <i data-lucide="user" class="w-32 h-32 text-primary-300"></i>
                            </div>
                        {% endif %}
                        
                        <!-- Status Badge -->
                        {% if featured_member.availability_status != 'available' %}
                        <div class="absolute top-6 right-6 z-10">
                            <div class="flex items-center gap-2 px-4 py-2 rounded-full border {{ featured_member.get_status_badge_class }} text-sm font-semibold shadow-lg backdrop-blur-sm animate-fade-in">
                                <i data-lucide="{{ featured_member.get_status_icon }}" class="w-4 h-4"></i>
                                <span>{{ featured_member.get_status_display_text }}</span>
                            </div>
                        </div>
                        {% else %}
                        <div class="absolute top-6 right-6 z-10">
                            <div class="flex items-center gap-2 px-4 py-2 rounded-full bg-green-100 border border-green-200 text-green-800 text-sm font-semibold shadow-lg backdrop-blur-sm animate-fade-in">
                                <span class="w-2.5 h-2.5 bg-green-500 rounded-full animate-pulse"></span>
                                <span>Tillg√§nglig nu</span>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                    
                    <!-- Info -->
                    <div class="p-8 md:p-12 flex flex-col justify-center">
                        <div class="mb-6">
                            <h3 class="text-3xl md:text-4xl font-bold text-gray-900 mb-2">
                                {{ featured_member.name }}
                            </h3>
                            <p class="text-xl text-primary-600 font-semibold">
                                {{ featured_member.title }}
                            </p>
                        </div>
                        
                        {% if featured_member.availability_note %}
                        <div class="mb-6 p-4 bg-gray-50 rounded-xl border border-gray-200">
                            <p class="text-sm text-gray-700 flex items-start gap-2">
                                <i data-lucide="info" class="w-5 h-5 mt-0.5 flex-shrink-0 text-gray-500"></i>
                                <span>{{ featured_member.availability_note }}</span>
                            </p>
                        </div>
                        {% endif %}
                        
                        {% if featured_member.bio %}
                        <div class="text-gray-700 leading-relaxed mb-8 prose">
                            {{ featured_member.bio|richtext }}
                        </div>
                        {% endif %}
                        
                        <!-- CTA -->
                        {% if featured_member.calendly_url and featured_member.availability_status != 'unavailable' %}
                        <a href="{{ featured_member.calendly_url }}" 
                           target="_blank"
                           rel="noopener"
                           class="btn-primary text-lg px-8 py-4 inline-flex items-center justify-center gap-2 mb-4 shadow-lg hover:shadow-xl hover:scale-105 w-full md:w-auto transition-all duration-300">
                            <i data-lucide="calendar" class="w-5 h-5"></i>
                            Boka m√∂te med {{ featured_member.get_first_name }}
                        </a>
                        {% endif %}
                        
                        <!-- Contact Options -->
                        <div class="flex flex-wrap gap-3 pt-6 border-t border-gray-200">
                            {% if featured_member.email and featured_member.availability_status != 'unavailable' %}
                            <a href="mailto:{{ featured_member.email }}" 
                               class="flex items-center gap-2 px-4 py-2 bg-gray-100 rounded-lg hover:bg-primary-600 hover:text-white hover:scale-105 transition-all duration-300">
                                <i data-lucide="mail" class="w-4 h-4"></i>
                                <span class="text-sm font-semibold">Email</span>
                            </a>
                            {% endif %}
                            
                            {% if featured_member.phone and featured_member.availability_status != 'unavailable' %}
                            <a href="tel:{{ featured_member.phone }}" 
                               class="flex items-center gap-2 px-4 py-2 bg-gray-100 rounded-lg hover:bg-primary-600 hover:text-white hover:scale-105 transition-all duration-300">
                                <i data-lucide="phone" class="w-4 h-4"></i>
                                <span class="text-sm font-semibold">Ring</span>
                            </a>
                            {% endif %}
                            
                            {% if featured_member.linkedin_url %}
                            <a href="{{ featured_member.linkedin_url }}" 
                               target="_blank"
                               rel="noopener"
                               class="flex items-center gap-2 px-4 py-2 bg-gray-100 rounded-lg hover:bg-primary-600 hover:text-white hover:scale-105 transition-all duration-300">
                                <i data-lucide="linkedin" class="w-4 h-4"></i>
                                <span class="text-sm font-semibold">LinkedIn</span>
                            </a>
                            {% endif %}
                        </div>
                        
                        <!-- Link till hela teamet -->
                        <div class="mt-6 pt-6 border-t border-gray-200">
                            {% if settings.core.NavigationSettings.team_page %}
                            <a href="{% pageurl settings.core.NavigationSettings.team_page %}"
                               class="text-primary-600 font-semibold inline-flex items-center gap-2 hover:gap-3 transition-all">
                                Se hela teamet
                                <i data-lucide="arrow-right" class="w-4 h-4"></i>
                            </a>
                            {% else %}
                            <a href="/mot-varat-team/"
                               class="text-primary-600 font-semibold inline-flex items-center gap-2 hover:gap-3 transition-all">
                                Se hela teamet
                                <i data-lucide="arrow-right" class="w-4 h-4"></i>
                            </a>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endif %}

<!-- Why Choose Us - Grid med stagger -->
<section class="py-20 bg-white">
    <div class="container mx-auto px-4">
        <div class="text-center max-w-3xl mx-auto mb-16 opacity-0 animate-fade-in-up" data-scroll>
            <h2 class="text-4xl md:text-5xl font-bold text-gray-900 mb-4">
                Varf√∂r v√§lja oss?
            </h2>
            <p class="text-xl text-gray-600">
                Vi g√∂r redovisning enkelt, transparent och tillg√§ngligt
            </p>
        </div>
        
        <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6 max-w-6xl mx-auto">
            <!-- Feature 1 -->
            <div class="feature-card bg-white border-2 border-gray-200 rounded-xl p-6 text-center hover:border-red-600 hover:shadow-xl hover:-translate-y-2 transition-all duration-500 group opacity-0" data-scroll style="animation-delay: 100ms">
                <div class="w-16 h-16 bg-red-100 rounded-xl flex items-center justify-center mx-auto mb-4 group-hover:scale-110 group-hover:rotate-6 group-hover:bg-red-600 transition-all duration-500 shadow-lg">
                    <i data-lucide="zap" class="w-8 h-8 text-red-600 group-hover:text-white transition-colors"></i>
                </div>
                <h3 class="text-lg font-bold text-gray-900 mb-2">Snabbt & Smidigt</h3>
                <p class="text-sm text-gray-600">Digital hantering</p>
            </div>
            
            <!-- Feature 2 -->
            <div class="feature-card bg-white border-2 border-gray-200 rounded-xl p-6 text-center hover:border-blue-600 hover:shadow-xl hover:-translate-y-2 transition-all duration-500 group opacity-0" data-scroll style="animation-delay: 200ms">
                <div class="w-16 h-16 bg-blue-100 rounded-xl flex items-center justify-center mx-auto mb-4 group-hover:scale-110 group-hover:rotate-6 group-hover:bg-blue-600 transition-all duration-500 shadow-lg">
                    <i data-lucide="heart-handshake" class="w-8 h-8 text-blue-600 group-hover:text-white transition-colors"></i>
                </div>
                <h3 class="text-lg font-bold text-gray-900 mb-2">Personlig Service</h3>
                <p class="text-sm text-gray-600">Din egen kontaktperson</p>
            </div>
            
            <!-- Feature 3 -->
            <div class="feature-card bg-white border-2 border-gray-200 rounded-xl p-6 text-center hover:border-green-600 hover:shadow-xl hover:-translate-y-2 transition-all duration-500 group opacity-0" data-scroll style="animation-delay: 300ms">
                <div class="w-16 h-16 bg-green-100 rounded-xl flex items-center justify-center mx-auto mb-4 group-hover:scale-110 group-hover:rotate-6 group-hover:bg-green-600 transition-all duration-500 shadow-lg">
                    <i data-lucide="file-badge" class="w-8 h-8 text-green-600 group-hover:text-white transition-colors"></i>
                </div>
                <h3 class="text-lg font-bold text-gray-900 mb-2">Transparent Priss√§ttning</h3>
                <p class="text-sm text-gray-600">Inga dolda avgifter</p>
            </div>
            
            <!-- Feature 4 -->
            <div class="feature-card bg-white border-2 border-gray-200 rounded-xl p-6 text-center hover:border-amber-600 hover:shadow-xl hover:-translate-y-2 transition-all duration-500 group opacity-0" data-scroll style="animation-delay: 400ms">
                <div class="w-16 h-16 bg-amber-100 rounded-xl flex items-center justify-center mx-auto mb-4 group-hover:scale-110 group-hover:rotate-6 group-hover:bg-amber-600 transition-all duration-500 shadow-lg">
                    <i data-lucide="users-round" class="w-8 h-8 text-amber-600 group-hover:text-white transition-colors"></i>
                </div>
                <h3 class="text-lg font-bold text-gray-900 mb-2">Erfarna Experter</h3>
                <p class="text-sm text-gray-600">Auktoriserade konsulter</p>
            </div>
        </div>
    </div>
</section>

<!-- CTA Section - Scale p√• hover -->
<section class="py-20 bg-primary-800 relative overflow-hidden">

    <div class="container mx-auto px-4 text-center relative">
        <div class="max-w-3xl mx-auto opacity-0 animate-fade-in-up" data-scroll>
            <h2 class="text-4xl md:text-5xl font-bold text-white mb-6">
                Redo att komma ig√•ng?
            </h2>
            <p class="text-xl text-white/90 mb-8">
                Boka ett kostnadsfritt m√∂te s√• ber√§ttar vi mer om hur vi kan hj√§lpa ditt f√∂retag.
            </p>
            <div class="flex flex-col sm:flex-row gap-4 justify-center">
                {% if settings.core.NavigationSettings.contact_page %}
                <a href="{% pageurl settings.core.NavigationSettings.contact_page %}"
                   class="btn-primary bg-white text-primary-800 hover:bg-white/90 hover:scale-105 inline-flex items-center gap-2 text-lg px-8 py-4 shadow-lg transition-all duration-300">
                    <i data-lucide="mail" class="w-5 h-5"></i>
                    Kontakta oss
                </a>
                {% else %}
                <a href="/kontakt/"
                   class="btn-primary bg-white text-primary-800 hover:bg-white/90 hover:scale-105 inline-flex items-center gap-2 text-lg px-8 py-4 shadow-lg transition-all duration-300">
                    <i data-lucide="mail" class="w-5 h-5"></i>
                    Kontakta oss
                </a>
                {% endif %}

                {% if settings.core.NavigationSettings.booking_url %}
                <a href="{{ settings.core.NavigationSettings.booking_url }}"
                   target="_blank"
                   rel="noopener noreferrer"
                   class="btn-secondary bg-white/10 text-white border-2 border-white hover:bg-white hover:text-primary-800 hover:scale-105 inline-flex items-center gap-2 text-lg px-8 py-4 transition-all duration-300">
                    <i data-lucide="calendar" class="w-5 h-5"></i>
                    Boka m√∂te
                </a>
                {% else %}
                <a href="/kontakt/"
                   class="btn-secondary bg-white/10 text-white border-2 border-white hover:bg-white hover:text-primary-800 hover:scale-105 inline-flex items-center gap-2 text-lg px-8 py-4 transition-all duration-300">
                    <i data-lucide="calendar" class="w-5 h-5"></i>
                    Boka m√∂te
                </a>
                {% endif %}
            </div>
        </div>
    </div>
</section>

<!-- Instagram Feed Placeholder - Rullande karusell -->
<section class="py-20 bg-white overflow-hidden">
    <div class="container mx-auto px-4 mb-12">
        <div class="text-center max-w-3xl mx-auto opacity-0 animate-fade-in-up" data-scroll>
            <h2 class="text-4xl md:text-5xl font-bold text-gray-900 mb-4">
                F√∂lj oss p√• Instagram
            </h2>
            <p class="text-xl text-gray-600 mb-6">
                Tips, nyheter och gl√§djespridning fr√•n v√•rt team
            </p>
            <a href="https://instagram.com/harpansredovisning" 
               target="_blank"
               rel="noopener"
               class="inline-flex items-center gap-2 text-primary-600 font-semibold hover:gap-3 transition-all">
                <i data-lucide="instagram" class="w-5 h-5"></i>
                @harpansredovisning
            </a>
        </div>
    </div>
    
    <!-- Auto-scrolling carousel -->
    <div class="relative">
        <div class="instagram-carousel flex gap-4 animate-scroll">
            <!-- Card 1 -->
            <div class="instagram-card flex-shrink-0 w-80 bg-white border-2 border-gray-200 rounded-2xl overflow-hidden hover:border-primary-600 hover:shadow-xl transition-all duration-300 group">
                <div class="aspect-square bg-gradient-to-br from-primary-100 to-secondary-100 relative overflow-hidden">
                    <div class="absolute inset-0 flex items-center justify-center">
                        <i data-lucide="image" class="w-16 h-16 text-gray-300"></i>
                    </div>
                    <!-- Overlay p√• hover -->
                    <div class="absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center">
                        <i data-lucide="instagram" class="w-12 h-12 text-white"></i>
                    </div>
                </div>
                <div class="p-4">
                    <p class="text-sm text-gray-600 line-clamp-2">
                        üìä Tips of the day: H√•ll koll p√• dina kvitton digitalt...
                    </p>
                    <div class="flex items-center gap-2 mt-3 text-xs text-gray-500">
                        <i data-lucide="heart" class="w-4 h-4"></i>
                        <span>47</span>
                        <i data-lucide="message-circle" class="w-4 h-4 ml-2"></i>
                        <span>5</span>
                    </div>
                </div>
            </div>
            
            <!-- Card 2 -->
            <div class="instagram-card flex-shrink-0 w-80 bg-white border-2 border-gray-200 rounded-2xl overflow-hidden hover:border-primary-600 hover:shadow-xl transition-all duration-300 group">
                <div class="aspect-square bg-gradient-to-br from-secondary-100 to-accent-100 relative overflow-hidden">
                    <div class="absolute inset-0 flex items-center justify-center">
                        <i data-lucide="image" class="w-16 h-16 text-gray-300"></i>
                    </div>
                    <div class="absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center">
                        <i data-lucide="instagram" class="w-12 h-12 text-white"></i>
                    </div>
                </div>
                <div class="p-4">
                    <p class="text-sm text-gray-600 line-clamp-2">
                        üíº Ny i veckan: Webinar om skatteregler f√∂r startups
                    </p>
                    <div class="flex items-center gap-2 mt-3 text-xs text-gray-500">
                        <i data-lucide="heart" class="w-4 h-4"></i>
                        <span>89</span>
                        <i data-lucide="message-circle" class="w-4 h-4 ml-2"></i>
                        <span>12</span>
                    </div>
                </div>
            </div>
            
            <!-- Card 3 -->
            <div class="instagram-card flex-shrink-0 w-80 bg-white border-2 border-gray-200 rounded-2xl overflow-hidden hover:border-primary-600 hover:shadow-xl transition-all duration-300 group">
                <div class="aspect-square bg-gradient-to-br from-accent-100 to-primary-100 relative overflow-hidden">
                    <div class="absolute inset-0 flex items-center justify-center">
                        <i data-lucide="image" class="w-16 h-16 text-gray-300"></i>
                    </div>
                    <div class="absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center">
                        <i data-lucide="instagram" class="w-12 h-12 text-white"></i>
                    </div>
                </div>
                <div class="p-4">
                    <p class="text-sm text-gray-600 line-clamp-2">
                        ‚òï Team Friday! Fikapaus med goda nyheter...
                    </p>
                    <div class="flex items-center gap-2 mt-3 text-xs text-gray-500">
                        <i data-lucide="heart" class="w-4 h-4"></i>
                        <span>124</span>
                        <i data-lucide="message-circle" class="w-4 h-4 ml-2"></i>
                        <span>8</span>
                    </div>
                </div>
            </div>
            
            <!-- Card 4 -->
            <div class="instagram-card flex-shrink-0 w-80 bg-white border-2 border-gray-200 rounded-2xl overflow-hidden hover:border-primary-600 hover:shadow-xl transition-all duration-300 group">
                <div class="aspect-square bg-gradient-to-br from-primary-100 via-secondary-100 to-accent-100 relative overflow-hidden">
                    <div class="absolute inset-0 flex items-center justify-center">
                        <i data-lucide="image" class="w-16 h-16 text-gray-300"></i>
                    </div>
                    <div class="absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center">
                        <i data-lucide="instagram" class="w-12 h-12 text-white"></i>
                    </div>
                </div>
                <div class="p-4">
                    <p class="text-sm text-gray-600 line-clamp-2">
                        üìà Success story: Hur vi hj√§lpte ett startup v√§xa...
                    </p>
                    <div class="flex items-center gap-2 mt-3 text-xs text-gray-500">
                        <i data-lucide="heart" class="w-4 h-4"></i>
                        <span>156</span>
                        <i data-lucide="message-circle" class="w-4 h-4 ml-2"></i>
                        <span>23</span>
                    </div>
                </div>
            </div>
            
            <!-- Duplicate cards for seamless loop -->
            <div class="instagram-card flex-shrink-0 w-80 bg-white border-2 border-gray-200 rounded-2xl overflow-hidden hover:border-primary-600 hover:shadow-xl transition-all duration-300 group">
                <div class="aspect-square bg-gradient-to-br from-primary-100 to-secondary-100 relative overflow-hidden">
                    <div class="absolute inset-0 flex items-center justify-center">
                        <i data-lucide="image" class="w-16 h-16 text-gray-300"></i>
                    </div>
                    <div class="absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center">
                        <i data-lucide="instagram" class="w-12 h-12 text-white"></i>
                    </div>
                </div>
                <div class="p-4">
                    <p class="text-sm text-gray-600 line-clamp-2">
                        üìä Tips of the day: H√•ll koll p√• dina kvitton digitalt...
                    </p>
                    <div class="flex items-center gap-2 mt-3 text-xs text-gray-500">
                        <i data-lucide="heart" class="w-4 h-4"></i>
                        <span>47</span>
                        <i data-lucide="message-circle" class="w-4 h-4 ml-2"></i>
                        <span>5</span>
                    </div>
                </div>
            </div>
            
            <div class="instagram-card flex-shrink-0 w-80 bg-white border-2 border-gray-200 rounded-2xl overflow-hidden hover:border-primary-600 hover:shadow-xl transition-all duration-300 group">
                <div class="aspect-square bg-gradient-to-br from-secondary-100 to-accent-100 relative overflow-hidden">
                    <div class="absolute inset-0 flex items-center justify-center">
                        <i data-lucide="image" class="w-16 h-16 text-gray-300"></i>
                    </div>
                    <div class="absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center">
                        <i data-lucide="instagram" class="w-12 h-12 text-white"></i>
                    </div>
                </div>
                <div class="p-4">
                    <p class="text-sm text-gray-600 line-clamp-2">
                        üíº Ny i veckan: Webinar om skatteregler f√∂r startups
                    </p>
                    <div class="flex items-center gap-2 mt-3 text-xs text-gray-500">
                        <i data-lucide="heart" class="w-4 h-4"></i>
                        <span>89</span>
                        <i data-lucide="message-circle" class="w-4 h-4 ml-2"></i>
                        <span>12</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', () => {
  console.log('[home] extra_js loaded');

  const reduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
  console.log('[home] reduced_motion:', reduced);

  // ---------- Edge glint on scroll ----------
  const sparkleLayer = document.getElementById('scroll-sparkle-layer');

  let lastScrollY = window.scrollY || 0;
  let lastGlintAt = 0;

  // Tweaks:
  const GLINT_DURATION_MS = 1600;   // matchar CSS edge_glint 1600ms
  const GLINT_COOLDOWN_MS = 700;    // hur ofta max
  const MIN_DOWN_DELTA_PX = 20;     // hur mycket nedscroll kr√§vs

  function maybeEdgeGlint(){
    if (reduced || !sparkleLayer) return;

    const y = window.scrollY || 0;
    const dy = y - lastScrollY;
    lastScrollY = y;

    if (dy < MIN_DOWN_DELTA_PX) return;

    const now = performance.now();
    if (now - lastGlintAt < GLINT_COOLDOWN_MS) return;
    lastGlintAt = now;

    sparkleLayer.classList.remove('is-active');
    void sparkleLayer.offsetHeight;
    sparkleLayer.classList.add('is-active');

    clearTimeout(sparkleLayer._t);
    sparkleLayer._t = setTimeout(() => {
      sparkleLayer.classList.remove('is-active');
    }, GLINT_DURATION_MS + 80);
  }

  // ---------- helpers ----------
  const clamp = (v, a, b) => Math.max(a, Math.min(b, v));
  const lerp  = (a, b, t) => a + (b - a) * t;
  const easeOutCubic = (t) => 1 - Math.pow(1 - t, 3);
  const easeInOutQuad = (t) => t < 0.5 ? 2*t*t : 1 - Math.pow(-2*t + 2, 2)/2;

  const getMaxTransitionMs = (node) => {
    const cs = getComputedStyle(node);
    const toMs = (v) => {
      v = (v || '').trim();
      if (!v) return 0;
      return v.endsWith('ms') ? parseFloat(v) : parseFloat(v) * 1000;
    };
    const durs = (cs.transitionDuration || '0s').split(',').map(s => toMs(s));
    const dels = (cs.transitionDelay || '0s').split(',').map(s => toMs(s));
    return Math.max(...durs, 0) + Math.max(...dels, 0);
  };

  const triggerSparkle = (el) => {
    if (!el || reduced) return;
    if (el.dataset.sparkled === "1") return;

    el.dataset.sparkled = "1";
    el.classList.add('sparkle-active');
    setTimeout(() => el.classList.remove('sparkle-active'), 2300);
  };

  // ---------- Scroll reveal + sparkle ----------
  const revealObserver = new IntersectionObserver((entries, obs) => {
    entries.forEach(entry => {
      if (!entry.isIntersecting) return;

      const block = entry.target;
      block.classList.add('visible');

      if (!reduced) {
        const waitMs = Math.max(650, getMaxTransitionMs(block) + 80);
        block.querySelectorAll('[data-sparkle].sparkle-once')
          .forEach(el => setTimeout(() => triggerSparkle(el), waitMs));
      }

      obs.unobserve(block);
    });
  }, { threshold: 0.12, rootMargin: '0px 0px -12% 0px' });

  document.querySelectorAll('[data-scroll]').forEach(el => revealObserver.observe(el));

  // ---------- Standalone sparkle ----------
  if (!reduced) {
    const standalone = Array.from(document.querySelectorAll('[data-sparkle].sparkle-once'))
      .filter(el => !el.closest('[data-scroll]'));

    if (standalone.length) {
      const sparkleObserver = new IntersectionObserver((entries, obs) => {
        entries.forEach(entry => {
          if (!entry.isIntersecting) return;
          triggerSparkle(entry.target);
          obs.unobserve(entry.target);
        });
      }, { threshold: 0.35, rootMargin: '0px 0px -10% 0px' });

      standalone.forEach(el => sparkleObserver.observe(el));
    }
  }

  // ---------- Instagram carousel pause on hover ----------
  const carousel = document.querySelector('.instagram-carousel');
  if (carousel) {
    carousel.addEventListener('mouseenter', () => carousel.style.animationPlayState = 'paused');
    carousel.addEventListener('mouseleave', () => carousel.style.animationPlayState = 'running');
  }

  // ---------- Parallax + Brand motion ----------
  const body = document.body;
  const hero = document.querySelector('[data-hero]');
  const navBrand = document.getElementById('nav-brand');
  const wordmark = document.getElementById('brand-wordmark');
  const parallaxImg = document.querySelector('.parallax-bg img');
  const nav = document.querySelector('nav');

  if (reduced) return;

  function updateParallax(){
    if (!parallaxImg) return;
    const y = window.scrollY || document.documentElement.scrollTop || 0;
    parallaxImg.style.transform = `translateY(${y * 0.5}px) scale(1.1)`;
  }

  function updateBrand(){
    if (!hero || !navBrand || !wordmark) return;

    // üîí Ingen Gucci-effekt p√• mobil, bara vanlig navbar
    if (window.innerWidth < 768) {
      body.classList.add('is-brand-docked');
      navBrand.style.opacity = '1';
      navBrand.style.transform = 'translateY(0)';
      wordmark.style.opacity = '0';
      return;
    }

    const navH = nav ? nav.getBoundingClientRect().height : 80;
    const heroRect = hero.getBoundingClientRect();
    const heroH = Math.max(1, heroRect.height);

    const scrolledInHero = clamp(-heroRect.top, 0, heroH);
    const tRaw = clamp(scrolledInHero / (heroH * 0.60), 0, 1);
    const t = easeOutCubic(tRaw);

    const startX = window.innerWidth / 2;
    const startY = navH + 90;

    const br = navBrand.getBoundingClientRect();
    const endX = br.left + br.width / 2;
    const endY = br.top + br.height / 2;

    const x = lerp(startX, endX, t);
    const y = lerp(startY, endY, t);
    const scale = lerp(1.0, 0.28, t);

    wordmark.style.left = `${x}px`;
    wordmark.style.top  = `${y}px`;
    wordmark.style.setProperty('--scale', String(scale));

    const reveal = clamp((tRaw - 0.82) / 0.18, 0, 1);
    const r = easeInOutQuad(reveal);

    navBrand.style.opacity = String(r);
    navBrand.style.transform = `translateY(${(1 - r) * 2}px)`;

    const docked = tRaw >= 0.985 || (heroRect.bottom <= navH + 6);
    if (docked) {
      body.classList.add('is-brand-docked');
      navBrand.style.opacity = '1';
      navBrand.style.transform = 'translateY(0)';
    } else {
      body.classList.remove('is-brand-docked');
    }

    wordmark.style.opacity = String(1 - r);
  }

  let ticking = false;
  function onScroll(){
    if (ticking) return;
    ticking = true;
    requestAnimationFrame(() => {
      updateParallax();
      updateBrand();
      maybeEdgeGlint();
      ticking = false;
    });
  }

  window.addEventListener('scroll', onScroll, { passive: true });
  window.addEventListener('resize', () => requestAnimationFrame(() => {
    updateParallax();
    updateBrand();
  }));

  updateParallax();
  updateBrand();
  maybeEdgeGlint(); // f√∂rsta ‚Äúk√§nslan‚Äù om man laddar mitt i scroll
});
</script>
{% endblock %}
