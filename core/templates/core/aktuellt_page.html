{% extends "base.html" %}
{% load wagtailcore_tags %}
{% load wagtailimages_tags %}

{% block extra_css %}
{{ block.super }}
<style>
  /* Styling för intro-rutan på "Aktuellt" */
  .skv-intro-rich a{
    display: inline-flex;
    align-items: center;
    gap: 0.35rem;
    padding: 0.3rem 0.8rem;
    border-radius: 9999px;
    background: rgba(255,255,255,0.96);
    border: 1px solid rgba(148, 27, 57, 0.18); /* justera till din primary om du vill */
    color: #7f1025;
    font-weight: 600;
    text-decoration: none;
    box-shadow: 0 6px 16px rgba(0,0,0,0.04);
    transition: all 180ms ease-out;
  }
  .skv-intro-rich a:hover{
    background: #7f1025;
    color: #fff;
    border-color: #7f1025;
    box-shadow: 0 10px 24px rgba(127,16,37,0.35);
    transform: translateY(-1px);
  }
  .skv-intro-rich a::after{
    content: "↗";
    font-size: 0.75rem;
    opacity: 0.8;
  }
</style>
{% endblock %}


{% block content %}

  {# HERO #}
  {% include "partials/hero.html" with page=page hero_title=page.title hero_intro=page.hero_lede show_breadcrumb=True hero_id="aktuellt-hero" %}

  {# Chips / snabblänkar – visuellt kopplade till heron #}
  {% if feed_sections %}
  <section class="relative z-20 -mt-10">
    <div class="container mx-auto px-4">
      <div class="inline-flex flex-wrap gap-2 p-3 rounded-2xl border backdrop-blur-md
                  {% if page.hero_image or page.hero_video %}
                    bg-white/10 border-white/20
                  {% else %}
                    bg-white border-gray-200
                  {% endif %}">
        {% for sec in feed_sections %}
          <a href="#feed-{{ forloop.counter }}"
             class="px-3 py-1.5 rounded-full text-sm font-semibold border transition
                    {% if page.hero_image or page.hero_video %}
                      bg-white/15 text-white border-white/20 hover:bg-white/25
                    {% else %}
                      bg-white text-primary-900 border-gray-200 hover:bg-primary-50
                    {% endif %}">
            {{ sec.title }}
          </a>
        {% endfor %}
      </div>
    </div>
  </section>
  {% endif %}

<section class="container mx-auto px-4 py-10">

  {% if page.intro or page.rattslig_vagledning_url %}
  <div class="mb-12">
    <div class="rounded-3xl bg-primary-50/70 border border-primary-100/80 
                px-6 py-7 md:px-10 md:py-8 shadow-sm">
      <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-8">
        
        {# Vänster sida: intro-text #}
        <div class="max-w-2xl">
          <div class="inline-flex items-center gap-2 text-xs font-semibold 
                      uppercase tracking-widest text-primary-700 mb-2">
            <span class="px-2.5 py-1 rounded-full bg-primary-100 text-primary-800">
              Nyhetscenter
            </span>
            <span class="text-primary-700/80">Skatteverket</span>
          </div>

          <h2 class="text-2xl md:text-3xl font-bold text-primary-900 mb-3">
            Håll koll på nya lagar, regler och viktiga datum
          </h2>

            {% if page.intro %}
              <div class="skv-intro-rich prose prose-sm md:prose-base prose-p:mb-2 md:prose-p:mb-3">
                {{ page.intro|richtext }}
              </div>
            {% else %}
              <p class="text-gray-800 leading-relaxed">
                Här samlar vi de senaste uppdateringarna från Skatteverket så att du
                slipper leta själv. Sidan uppdateras automatiskt via deras RSS-flöden.
              </p>
            {% endif %}

        </div>

        {# Höger sida: små “benefit”-kort / länkar #}
        <div class="grid gap-3 text-sm text-gray-800 md:text-right">
          <div class="inline-flex md:justify-end items-center gap-2 px-3 py-2 
                      rounded-full bg-white/80 border border-primary-100">
            <i data-lucide="rss" class="w-4 h-4 text-primary-700"></i>
            <span>Automatiskt uppdaterad via RSS</span>
          </div>

          <div class="inline-flex md:justify-end items-center gap-2 px-3 py-2 
                      rounded-full bg-white/80 border border-primary-100">
            <i data-lucide="shield-check" class="w-4 h-4 text-primary-700"></i>
            <span>Direkt från Skatteverkets källor</span>
          </div>

          {% if page.rattslig_vagledning_url %}
          <a href="{{ page.rattslig_vagledning_url }}"
             target="_blank" rel="noopener"
             class="inline-flex md:justify-end items-center gap-2 px-3 py-2 
                    rounded-full bg-primary-800 text-white font-semibold
                    hover:bg-primary-700 transition-colors">
            <i data-lucide="book-open" class="w-4 h-4"></i>
            <span>Rättslig vägledning från Skatteverket</span>
          </a>
          {% endif %}
        </div>

      </div>
    </div>
  </div>
  {% endif %}


    {# “Senaste uppdateringarna” - mer “magasin”-känsla #}
    {% if latest_items %}
      <div class="mb-12">
        <div class="flex items-end justify-between gap-4 mb-4">
          <div>
            <h2 class="text-2xl font-bold text-primary-900">Senaste uppdateringarna</h2>
          </div>
        </div>

        <div class="grid grid-cols-12 gap-4">
          {% for item in latest_items %}
            <a href="{{ item.link }}" target="_blank" rel="noopener"
               class="skv-card skv-card--grid {% if forloop.first %}skv-card--featured col-span-12 lg:col-span-7{% else %}col-span-12 sm:col-span-6 lg:col-span-5{% endif %}">
              <div class="skv-top">
                <div class="skv-badge skv-badge--{{ item.source|slugify }}">{{ item.source }}</div>
                <div class="skv-meta">{{ item.published }}</div>
              </div>

              <div class="skv-title">{{ item.title }}</div>

              {% if item.summary %}
                <div class="skv-summary">{{ item.summary }}</div>
              {% else %}
                <div class="skv-summary skv-summary--empty">Klicka för att läsa mer…</div>
              {% endif %}

              <div class="skv-cta">Läs mer <span aria-hidden="true">→</span></div>
            </a>
          {% endfor %}
        </div>
      </div>
    {% endif %}

    {# Flöden #}
    {% for sec in feed_sections %}
      <div class="mb-12 scroll-mt-28" id="feed-{{ forloop.counter }}">
        <div class="flex items-baseline justify-between gap-4 mb-3">
          <h2 class="text-xl font-bold text-primary-900">{{ sec.title }}</h2>
          {% if sec.note %}<p class="text-sm text-gray-600">{{ sec.note }}</p>{% endif %}
        </div>

        {% if sec.items %}
          <div class="skv-ticker">
            <div class="skv-track">
              {% for item in sec.items %}
                <a class="skv-card" href="{{ item.link }}" target="_blank" rel="noopener">
                  <div class="skv-badge skv-badge--{{ sec.title|slugify }}">{{ sec.title }}</div>
                  <div class="skv-title">{{ item.title }}</div>
                  <div class="skv-meta">{{ item.published }}</div>

                  {% if item.summary %}
                    <div class="skv-summary">{{ item.summary }}</div>
                  {% else %}
                    <div class="skv-summary skv-summary--empty">Klicka för att läsa mer…</div>
                  {% endif %}

                  <div class="skv-cta">Läs mer →</div>
                </a>
              {% endfor %}

              {# duplicera samma items för “oändlig” loop #}
              {% for item in sec.items %}
                <a class="skv-card" href="{{ item.link }}" target="_blank" rel="noopener">
                  <div class="skv-badge skv-badge--{{ sec.title|slugify }}">{{ sec.title }}</div>
                  <div class="skv-title">{{ item.title }}</div>
                  <div class="skv-meta">{{ item.published }}</div>

                  {% if item.summary %}
                    <div class="skv-summary">{{ item.summary }}</div>
                  {% else %}
                    <div class="skv-summary skv-summary--empty">Klicka för att läsa mer…</div>
                  {% endif %}

                  <div class="skv-cta">Läs mer →</div>
                </a>
              {% endfor %}
            </div>
          </div>
        {% else %}
          <div class="skv-empty">
            Inga inlägg just nu i detta flöde.
          </div>
        {% endif %}
      </div>
    {% endfor %}

    {# Extra innehåll #}
    {% if page.body %}
      <div class="prose max-w-none mt-12">
        {{ page.body }}
      </div>
    {% endif %}

  </section>
{% endblock %}
